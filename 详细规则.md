# 详细内容

### map

- #### 空白格（Empty Tiles）

  **这些是太空中的空瓷砖，没有任何特别之处**。单元和节点可以放置/移动到这些图块上

- #### 小行星地块（Asteroid Tiles）

  **小行星地块是无法通行的地块，会阻止任何物体移动或生成到其上**。这些地块可能会随着时间推移以对称的方式在地图上移动。有时，小行星地块可能会移动到现有单位的上方。在游戏中，这不会导致该单位被移除，且只要其相邻有非小行星地块，单位仍然可以采取行动并自由移动。

- #### 星云格（Nebula Tiles）

  **星云地块是可通行的地块，并具有以下特性**。这些地块可能会随着时间推移以对称的方式在地图上移动。

  **视野削减**：星云地块可以减少或阻挡单位的视野。由于视野削减，甚至可能出现单位无法看到自己的情况，但仍然能够移动！关于团队视野的确定方式，请参阅下文的“视野”部分。所有星云地块的视野削减值相同，称为 `params.nebula_tile_vision_reduction`，该值在 0 到 3 之间随机生成。

  **能量削减**：星云地块可以减少在其上结束回合的单位的能量。所有星云地块的能量削减值相同，称为 `params.nebula_tile_energy_reduction`。

- #### 能量节点（Energy Nodes）

  能量节点是神秘的物体，**会释放能量场，可供单位采集**。这些节点可能会随着时间推移以对称的方式在地图上移动。在代码中，每局游戏中实际发生的情况是，能量节点会在地图上以对称的方式随机生成，并且为每个节点生成一个随机函数。每个能量节点的函数是距离的函数。地图上某个地块的能量值由能量节点函数应用于该地块与每个节点之间的距离后取总和来决定。

- #### 遗迹节点（Relic Nodes）

  **遗物节点是太空中的物体，允许舰船靠近它以为团队获得积分**。然而，这些遗物节点由于年代久远而破碎不堪。因此，只有当友方舰船位于某些特定的遗物节点附近地块上时，这些地块才会产生积分。能够产生积分的地块始终是隐藏的，只有通过反复尝试在遗物节点周围移动才能发现。遗物节点本身的位置可以通过传感器范围内的观察发现。遗物节点周围的地块可能与其他遗物节点的地块重叠，但在这种情况下不会额外产生积分，而是视为同一地块。

  在代码中，**会为每个遗物节点生成一个以遗物节点为中心的随机 5x5 configuration /掩码，用于指示哪些地块可以产生积分**，哪些不能。多个舰船可以堆叠在同一个地块上，但每个地块最多只能产生 1 分。需要注意的是，舰船堆叠可能存在风险，因为可能受到汲取动作的影响（参见下文的“汲取动作”部分）。

### units

定义：游戏中的单位是舰船，**能够在 5 个方向（中心、上、右、下、左）中移动一个地块，并执行远程能量汲取动作**。单位可以与其他友方单位重叠，当它们移动到相同地块时会发生重叠。单位有一个能量属性，用于决定它们是否可以执行动作。单位初始能量为 100，最大能量上限为 400。能量通过地图上的能量场进行补充。单位总是根据所属队伍出生在地图的两个角之一。

需要注意的是，当单位位于星云地块或能量场时，这些地块可以修改单位的能量值。然而，这些地块永远不会将单位的能量减少到 0 以下，只有敌方单位可以做到这一点，此时单位会被移出游戏并在稍后的时间点重新生成。每个队伍的单位 ID 范围从 0 到 `params.max_units - 1`，当单位被移除后重新生成时，其 ID 会被循环使用。

- #### 移动动作（Move Actions）

  **除了移动到中心外，所有移动动作都会消耗 `params.unit_move_cost` 的能量**。移动到中心（即原地不动）始终是免费的（零动作）。尝试移动到地图边界之外会导致移动失败，但能量仍然会被消耗。单位无法移动到具有无法通行特性的地块上，例如小行星地块。

- #### 汲取动作（Sap Actions）

  **汲取动作允许单位以地图上的特定地块为目标，该目标地块需在范围 `params.unit_sap_range` 内**。汲取动作会消耗目标地块上每个敌方单位的能量，削减值为 `params.unit_sap_cost`，**同时自身也会消耗等量的能量**。此外，目标地块周围 8 个相邻地块上的敌方单位也会受到汲取影响，其能量会减少 `params.unit_sap_cost * params.unit_sap_dropoff_factor`。

  汲取动作以相对于单位当前位置的 x 和 y 的增量（delta x 和 delta y）形式提交给游戏引擎/环境。delta x 和 delta y 的绝对值必须都小于等于 `params.unit_sap_range`，因此汲取范围实际上是围绕单位的一个正方形区域。

  通常，汲取动作具有一定风险，因为一旦未命中，友方舰船会损失能量，而对手不会。然而，根据游戏参数，汲取动作的范围效果可以在一定程度上缓解这种风险。特别是在敌方舰船大量堆叠并被命中的情况下，汲取动作的价值会显得尤为突出，因为攻击堆叠地块时会对地块上的每一艘舰船造成能量削减。

- #### 视野（Vision ）

  一个团队的视野是其所有单位视野的综合表现。本质上，团队视野是一个布尔掩码/矩阵，覆盖整个二维地图，用于指示某个地块的信息是否对该团队可见。在游戏中，可以将每个单位想象为拥有一个“天眼”卫星，该卫星捕获单位周围的信息，但随着地块距离单位越来越远，其精度会逐渐降低。

  要确定地图上哪些地块对某个团队可见，需要为地图上的每个地块计算一个视野强度值。对于团队中的每个单位，我们检查该单位传感器范围内的每个地块，并将 `1 + params.unit_sensor_range - min(dx, dy)` 添加到视野强度图上对应的地块 `(x+dx, y+dy)`。其中 `(x, y)` 是单位的位置，`(dx, dy)` 是相对于单位位置的偏移量，且满足 `abs(dx) <= params.unit_sensor_range` 和 `abs(dy) <= params.unit_sensor_range`。

  如果某个地块是星云地块，则该地块的视野强度会减去 `params.nebula_tile_vision_reduction`，这是星云地块的视野削减值。

  例如，在没有星云地块的情况下，视野强度值如下所示，围绕单位生成一个正方形的可视范围。

  ![image-20250120201632074](https://my-typora-p1.oss-cn-beijing.aliyuncs.com/typoraImgs/image-20250120201632074.png)

  当一个单位靠近星云图块时，它无法看到某些星云图块的详细信息，但它可以看到星云图块之外的图块。这里，该单元的传感器范围为 2，星云图块视力降低值为 2。它可以看到自己，因为以该单元为中心的视觉功率为 3，但它看不到其他星云图块，因为它们太远或太远。星云瓦片视力降低将视力降低至 0 或更低。

  > 蓝色代表星云

  ![image-20250120201706892](https://my-typora-p1.oss-cn-beijing.aliyuncs.com/typoraImgs/image-20250120201706892.png)

  当一个单位位于星云块内时，如果星云视野减弱足够强大（这里星云视野减弱为3，单位传感器范围为2），该单位甚至看不到自己或任何其他星云块。

  ![image-20250120201729684](https://my-typora-p1.oss-cn-beijing.aliyuncs.com/typoraImgs/image-20250120201729684.png)

  单位视觉可以重叠并线性增加视力，这可以帮助处理像上面这样看不到任何东西的情况。以下星云视野减少为 3，单位传感器范围为 2，现在由于两个单位的视野重叠，一些星云图块可见。

  ![image-20250120201819526](https://my-typora-p1.oss-cn-beijing.aliyuncs.com/typoraImgs/image-20250120201819526.png)

  

- #### 直接碰撞或能量空洞（Collisions / Energy Void Fields）

  在近距离接触中，单位之间可以通过两种方式产生影响：**直接碰撞**或**通过彼此相邻并利用其“能量空洞场”吸取能量**。

  当来自对立团队的**两个或更多单位在回合结束时占据同一个地块时，拥有该地块上单位总能量最高的团队的单位将幸存**，而对立团队的单位会被移出游戏。如果总能量相同，所有单位都会被移出游戏。

  此外，**每个单位会在自身周围生成一个“能量空洞”场，对所有与其在四个基本方向（上、右、下、左）相邻的敌方单位产生影响**。为了精确确定这些能量空洞场如何影响每个单位，我们为每个团队计算一个二维地图，用于指示每个地块上的能量空洞强度。单位对其相邻地块的能量空洞贡献等于该单位在回合开始时的总能量乘以 `params.unit_energy_void_factor` 并向下取整。计算出每个团队的能量空洞地图后，单位的能量会减少其所在地块上的能量空洞强度除以该地块上单位总数的值。需要注意的是，由于碰撞而被移除的单位不会对能量空洞场产生贡献。

  能量空洞场通常会促使单位进行堆叠，每个敌方单位所受的能量减少由其所在格子的**总能量空场强度**决定。

  如果一个格子上有多台敌方单位，这些单位会平分该格子的总能量空场强度。

- #### 遗迹节点（Relic Nodes）

  **遗物节点是太空中的物体，允许舰船靠近它以为团队获得积分**。然而，这些遗物节点由于年代久远而破碎不堪。因此，只有当友方舰船位于某些特定的遗物节点附近地块上时，这些地块才会产生积分。能够产生积分的地块始终是隐藏的，只有通过反复尝试在遗物节点周围移动才能发现。遗物节点本身的位置可以通过传感器范围内的观察发现。遗物节点周围的地块可能与其他遗物节点的地块重叠，但在这种情况下不会额外产生积分，而是视为同一地块。

  在代码中，**会为每个遗物节点生成一个以遗物节点为中心的随机 5x5 configuration /掩码，用于指示哪些地块可以产生积分**，哪些不能。多个舰船可以堆叠在同一个地块上，但每个地块最多只能产生 1 分。需要注意的是，舰船堆叠可能存在风险，因为可能受到汲取动作的影响（参见下文的“汲取动作”部分）。

### 游戏本身

- #### Win Conditions

  BO5比赛，**为了赢得一场比赛，该队必须在比赛结束时比另一队获得更多的遗迹points **。如果遗迹积分打平，则根据单位总能量多者决定胜负。如果也打平，则随机选择获胜者。

- #### 行动顺序

  在比赛的每个时间步，我们按以下顺序执行以下步骤：

  1. 移动所有有足够能量进行移动的单位。
  2. 执行所有有足够能量进行汲取动作的单位的汲取操作。
  3. 处理碰撞并应用能量空洞场的影响。
  4. 根据单位所在位置（如能量场和星云地块）更新所有单位的能量。
  5. 为所有团队生成新单位，并移除能量小于 0 的单位。
  6. 确定所有团队的视野/传感器掩码，并据此屏蔽观察结果。
  7. 让环境中的物体（如小行星、星云地块、能量节点）在空间中移动。
  8. 计算新的团队积分。

  需要注意的是，每场比赛运行 `params.max_steps_in_match` 步，您可以执行相应数量的动作来影响游戏。然而，您实际上会收到 `params.max_steps_in_match + 1` 帧的观察结果，因为第一帧要么是空的，要么是上一场比赛的最终观察结果（基于这些观察结果执行的动作不会产生任何效果）。